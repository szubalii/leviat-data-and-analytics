steps:

- script: |
    docker run -e "ACCEPT_EULA=Y" -e "MSSQL_SA_PASSWORD=$(mssql_sa_pwd)" -p 1433:1433 -d mcr.microsoft.com/mssql/server:2022-latest
  displayName: 'Start a mssql-server instance for SQL Server 2022'


# - script: |
#     sqlcmd -S localhost -U sa -P P@ssw0rd -d master -Q "select getdate()"
#     if [ $? -eq 0 ]
#     then
#         echo "sql server ready"
#         break
#     else
#         echo "not ready yet..."
#         sleep 1
#     fi
#   displayName: 'Start a mssql-server instance for SQL Server 2022'

# - script: |
#   docker exec -it <container_id|container_name> /opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P <your_password>
#   displayName: 'Deploy Projects'
#   with:
#     connection-string: "Server=localhost;Initial Catalog=testingDB;User ID=sa;Password=P@ssw0rd;Encrypt=False;TrustServerCertificate=False;"  # the local connection string
#     path: './TestsSQLServer/TestsSQLServer.sqlproj' # the SQLproj file
#     action: 'Publish'
#     arguments: '/p:IncludeCompositeObjects=True'

# - script: 'Run tSQLt tests'
#   uses: azure/sql-action@v2
#   with:
#     connection-string: "Server=localhost;Initial Catalog=testingDB;User ID=sa;Password=P@ssw0rd;"  # the local connection string
#     path: './TestsSQLServer/myTests/demoExecAzureSQL.sql' # the tsqlt test command