# Orchestration Database Build & Deploy Job
parameters:
- name: artifact
  type: boolean
  default: false
- name: deploy
  type: boolean
  default: false
- name: test
  type: boolean
  default: false

jobs:
- job: OrchDBBuild
  dependsOn: StartVM
  pool:
    name: 'VM'
    demands:
    - node.js
    - VisualStudio
  variables:
    orchDBSolution: '**/orchestration/*.sln'
    buildPlatform: 'Any CPU'
    buildConfiguration: 'Release'

  steps:
  - template: ./steps-build.yml
  # deploy only if required.
  - ${{ if eq(parameters.deploy, true) }}: 
    - template: ./steps-deploy.yml
  # test only if required
  - ${{ if eq(parameters.test, true) }}: 
    - template: ./steps-test.yml
  # create artifact only if required
  - ${{ if eq(parameters.artifact, true) }}: 
    - template: ./steps-artifact.yml
    

  # - template: ./steps-build.yml
  # TODO check if condition works which should according to doc:
  # https://learn.microsoft.com/en-us/azure/devops/pipelines/process/templates?view=azure-devops#parameters-to-select-a-template-at-runtime
  # or else maybe extending from a template
  # https://learn.microsoft.com/en-us/azure/devops/pipelines/process/templates?view=azure-devops#extend-from-a-template
  # - ${{ if eq(parameters.deployEnv, 'personal') }}: 
  #   - template: ./steps-deploy.yml
