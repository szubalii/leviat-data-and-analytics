# Orchestration Database Build & Deploy Job
parameters:
- name: env
  type: string
  default: DEV
- name: varGroup
  type: string
  default: DnA_DEV
- name: keyVaultVarGroup
  type: string
  default: KeyVault_DEV

jobs:
- deployment: OrchDBDeploy
  variables:
  - name: pathPrefix
    value: $(Pipeline.Workspace)
  - group: ${{ parameters.varGroup }}
  - group: ${{ parameters.keyVaultVarGroup }}
  # ${{ if eq(parameters.deploy, true) }}:
  # - dependsOn: OrchDBBuild
  # - condition: succeeded('OrchDBBuild')
  # dependsOn: ${{if eq($(deployEnv),'personal'),OrchDBBuild,)}}
  pool:
    name: 'VM'
    demands:
    - node.js
    - VisualStudio
    - Agent.Name -equals $(VMName)
  
  environment: ${{ parameters.env }}
  strategy:
    runOnce:
      deploy:
        steps:
        - template: ./steps-deploy.yml
