CREATE VIEW [edw].[vw_ACDOCA]
AS
WITH PA AS (
  SELECT
    PurchaseOrder,
    PurchaseOrderItem,
    ICSalesDocumentID,
    ICSalesDocumentItemID
  FROM
    [edw].[dim_PurgAccAssignment]
  GROUP BY
    PurchaseOrder,
    PurchaseOrderItem,
    ICSalesDocumentID,
    ICSalesDocumentItemID
)
, GLAccountLineItemRawData AS (
    SELECT
       [SourceLedger]                           AS [SourceLedgerID],
       [CompanyCode]                            AS [CompanyCodeID],
       [FiscalYear],
       [AccountingDocument],
       [LedgerGLLineItem],
       [LedgerFiscalYear],
       [GLRecordType]                           AS [GLRecordTypeID],
       [ChartOfAccounts]                        AS [ChartOfAccountsID],
       [ControllingArea]                        AS [ControllingAreaID],
       [FinancialTransactionType]               AS [FinancialTransactionTypeID],
       [BusinessTransactionType]                AS [BusinessTransactionTypeID],
       [ControllingBusTransacType]              AS [ControllingBusTransacTypeID],
       [ReferenceDocumentType]                  AS [ReferenceDocumentTypeID],
       [ReferenceDocumentContext]               AS [ReferenceDocumentContextID],
       [ReferenceDocument],
       [ReferenceDocumentItem],
       [ReferenceDocumentItemGroup]             AS [ReferenceDocumentItemGroupID],
       [IsReversal],
       [IsReversed],
       [PredecessorReferenceDocType]            AS [PredecessorReferenceDocTypeID],
       [ReversalReferenceDocumentCntxt]         AS [ReversalReferenceDocumentCntxtID],
       [ReversalReferenceDocument],
       [IsSettlement],
       [IsSettled],
       [PredecessorReferenceDocument],
       [PredecessorReferenceDocItem],
       [SourceReferenceDocumentType]            AS [SourceReferenceDocumentTypeID],
       [SourceReferenceDocument],
       [SourceReferenceDocumentItem],
       [IsCommitment],
       [JrnlEntryItemObsoleteReason]            AS [JrnlEntryItemObsoleteReasonID],
       [GLAccount]                              AS [GLAccountID],
       [CostCenter]                             AS [CostCenterID],
       [ProfitCenter]                           AS [ProfitCenterID],
       [FunctionalArea]                         AS [FunctionalAreaID],
       [BusinessArea]                           AS [BusinessAreaID],          
       [Segment]                                AS [SegmentID],
       [PartnerCostCenter]                      AS [PartnerCostCenterID],
       [PartnerProfitCenter]                    AS [PartnerProfitCenterID],
       [PartnerFunctionalArea]                  AS [PartnerFunctionalAreaID],
       [PartnerBusinessArea]                    AS [PartnerBusinessAreaID],
       [PartnerCompany]                         AS [PartnerCompanyID],
       [PartnerSegment]                         AS [PartnerSegmentID],
       [BalanceTransactionCurrency],
       [AmountInBalanceTransacCrcy],
       [TransactionCurrency],
       [AmountInTransactionCurrency],
       [CompanyCodeCurrency],
       [AmountInCompanyCodeCurrency],
       [GlobalCurrency],
       [AmountInGlobalCurrency],
       [FreeDefinedCurrency1],
       [AmountInFreeDefinedCurrency1],
       [FreeDefinedCurrency2],
       [AmountInFreeDefinedCurrency2],
       [BaseUnit],
       [Quantity],
       [DebitCreditCode]                        AS [DebitCreditID], 
       [FiscalPeriod], 
       [FiscalYearVariant],
       [FiscalYearPeriod],
       [PostingDate],
       [DocumentDate],
       [AccountingDocumentType]                 AS [AccountingDocumentTypeID],
       [AccountingDocumentItem],
       [AssignmentReference],
       [AccountingDocumentCategory]             AS [AccountingDocumentCategoryID],
       [PostingKey]                             AS [PostingKeyID],
       [TransactionTypeDetermination]           AS [TransactionTypeDeterminationID],
       [SubLedgerAcctLineItemType]              AS [SubLedgerAcctLineItemTypeID],
       [AccountingDocCreatedByUser]             AS [AccountingDocCreatedByUserID],
       [LastChangeDateTime],
       [CreationDateTime],
       [CreationDate],
       [OriginObjectType]                       AS [OriginObjectTypeID],
       GLAccountLineItemRawData.[GLAccountType] AS [GLAccountTypeID],
       [InvoiceReference],
       [InvoiceReferenceFiscalYear],
       [InvoiceItemReference],
       [ReferencePurchaseOrderCategory]         AS [ReferencePurchaseOrderCategoryID],
       [PurchasingDocument],
       [PurchasingDocumentItem],
       [AccountAssignmentNumber],
       [DocumentItemText],
       [SalesDocument]                          AS [SalesDocumentID],          
       [SalesDocumentItem]                      AS [SalesDocumentItemID],
       [Product]                                AS [ProductID],
       [Plant]                                  AS [PlantID],
       [Supplier]                               AS [SupplierID],
       [Customer]                               AS [CustomerID],
       [ExchangeRateDate],                    
       [FinancialAccountType]                   AS [FinancialAccountTypeID],
       [SpecialGLCode]                          AS [SpecialGLCodeID],
       [TaxCode]                                AS [TaxCodeID],
       [ClearingDate],
       [ClearingAccountingDocument],
       [ClearingDocFiscalYear],
       [LineItemIsCompleted],
       [PersonnelNumber],
       [PartnerCompanyCode]                     AS [PartnerCompanyCodeID],
       [OriginProfitCenter]                     AS [OriginProfitCenterID],
       [OriginCostCenter]                       AS [OriginCostCenterID],
       [AccountAssignment]                      AS [AccountAssignmentID],
       [AccountAssignmentType]                  AS [AccountAssignmentTypeID],
       [CostCtrActivityType]                    AS [CostCtrActivityTypeID],
       [OrderID],
       [OrderCategory]                          AS [OrderCategoryID],
       [WBSElement]                             AS [WBSElementID],
       [ProjectInternalID],
       [Project]                                AS [ProjectID],
       [OperatingConcern]                       AS [OperatingConcernID],
       [BusinessProcess]                        AS [BusinessProcessID],
       [CostObject]                             AS [CostObjectID],
       [BillableControl]                        AS [BillableControlID],
       [ServiceDocumentType]                    AS [ServiceDocumentTypeID],
       [ServiceDocument],
       [ServiceDocumentItem],
       [BillingDocumentType]                    AS [BillingDocumentTypeID],
       [SalesOrganization]                      AS [SalesOrganizationID],
       [DistributionChannel]                    AS [DistributionChannelID],
       GLAccountLineItemRawData.[SalesDistrict] AS [SalesDistrictID],
       [BillToParty]                            AS [BillToPartyID],
       [ShipToParty]                            AS [ShipToPartyID], 
       [KMVKBUPA]                               AS [SalesOfficeID],
       [SoldProduct],
       GLAccountLineItemRawData.[t_applicationId],
       GLAccountLineItemRawData.[t_extractionDtm]
--FROM [base_s4h_cax].[I_GLAccountLineItemRawData] GLAccountLineItemRawData 
FROM [base_s4h_cax].[I_GLAccountLineItemRawData_upto2022] GLAccountLineItemRawData 
       UNION ALL
SELECT 
       [SourceLedger],
       [CompanyCode],
       [FiscalYear],
       [AccountingDocument],
       [LedgerGLLineItem],
       [LedgerFiscalYear],
       [GLRecordType],
       [ChartOfAccounts],
       [ControllingArea],
       [FinancialTransactionType],
       [BusinessTransactionType],
       [ControllingBusTransacType],
       [ReferenceDocumentType],
       [ReferenceDocumentContext],
       [ReferenceDocument],
       [ReferenceDocumentItem],
       [ReferenceDocumentItemGroup],
       [IsReversal],
       [IsReversed],
       [PredecessorReferenceDocType],
       [ReversalReferenceDocumentCntxt],
       [ReversalReferenceDocument],
       [IsSettlement],
       [IsSettled],
       [PredecessorReferenceDocument],
       [PredecessorReferenceDocItem],
       [SourceReferenceDocumentType],
       [SourceReferenceDocument],
       [SourceReferenceDocumentItem],
       [IsCommitment],
       [JrnlEntryItemObsoleteReason],
       [GLAccount],
       [CostCenter],
       [ProfitCenter],
       [FunctionalArea],
       [BusinessArea],
       [Segment],
       [PartnerCostCenter],
       [PartnerProfitCenter],
       [PartnerFunctionalArea],
       [PartnerBusinessArea],
       [PartnerCompany],
       [PartnerSegment],
       [BalanceTransactionCurrency],
       [AmountInBalanceTransacCrcy],
       [TransactionCurrency],
       [AmountInTransactionCurrency],
       [CompanyCodeCurrency],
       [AmountInCompanyCodeCurrency],
       [GlobalCurrency],
       [AmountInGlobalCurrency],
       [FreeDefinedCurrency1],
       [AmountInFreeDefinedCurrency1],
       [FreeDefinedCurrency2],
       [AmountInFreeDefinedCurrency2],
       [BaseUnit],
       [Quantity],
       [DebitCreditCode],
       [FiscalPeriod], 
       [FiscalYearVariant],
       [FiscalYearPeriod],
       [PostingDate],
       [DocumentDate],
       [AccountingDocumentType],
       [AccountingDocumentItem],
       [AssignmentReference],
       [AccountingDocumentCategory],
       [PostingKey],
       [TransactionTypeDetermination],
       [SubLedgerAcctLineItemType],
       [AccountingDocCreatedByUser],
       [LastChangeDateTime],
       [CreationDateTime],
       [CreationDate],
       [OriginObjectType],
       GLAccountLineItemRawData.[GLAccountType],
       [InvoiceReference],
       [InvoiceReferenceFiscalYear],
       [InvoiceItemReference],
       [ReferencePurchaseOrderCategory],
       [PurchasingDocument],
       [PurchasingDocumentItem],
       [AccountAssignmentNumber],
       [DocumentItemText],
       [SalesDocument],
       [SalesDocumentItem],
       [Product],
       [Plant],
       [Supplier],
       [Customer],
       [ExchangeRateDate],                    
       [FinancialAccountType],
       [SpecialGLCode],
       [TaxCode],
       [ClearingDate],
       [ClearingAccountingDocument],
       [ClearingDocFiscalYear],
       [LineItemIsCompleted],
       [PersonnelNumber],
       [PartnerCompanyCode],
       [OriginProfitCenter],
       [OriginCostCenter],
       [AccountAssignment],
       [AccountAssignmentType],
       [CostCtrActivityType],
       [OrderID],
       [OrderCategory],
       [WBSElement],
       [ProjectInternalID],
       [Project],
       [OperatingConcern],
       [BusinessProcess],
       [CostObject],
       [BillableControl],
       [ServiceDocumentType],
       [ServiceDocument],
       [ServiceDocumentItem],
       [BillingDocumentType],
       [SalesOrganization],
       [DistributionChannel],
       GLAccountLineItemRawData.[SalesDistrict],
       [BillToParty],
       [ShipToParty],
       [KMVKBUPA],
       [SoldProduct],
       GLAccountLineItemRawData.[t_applicationId],
       GLAccountLineItemRawData.[t_extractionDtm]
FROM [base_s4h_cax].[I_GLAccountLineItemRawData_202301] GLAccountLineItemRawData 
       UNION ALL
SELECT 
       [SourceLedger],
       [CompanyCode],
       [FiscalYear],
       [AccountingDocument],
       [LedgerGLLineItem],
       [LedgerFiscalYear],
       [GLRecordType],
       [ChartOfAccounts],
       [ControllingArea],
       [FinancialTransactionType],
       [BusinessTransactionType],
       [ControllingBusTransacType],
       [ReferenceDocumentType],
       [ReferenceDocumentContext],
       [ReferenceDocument],
       [ReferenceDocumentItem],
       [ReferenceDocumentItemGroup],
       [IsReversal],
       [IsReversed],
       [PredecessorReferenceDocType],
       [ReversalReferenceDocumentCntxt],
       [ReversalReferenceDocument],
       [IsSettlement],
       [IsSettled],
       [PredecessorReferenceDocument],
       [PredecessorReferenceDocItem],
       [SourceReferenceDocumentType],
       [SourceReferenceDocument],
       [SourceReferenceDocumentItem],
       [IsCommitment],
       [JrnlEntryItemObsoleteReason],
       [GLAccount],
       [CostCenter],
       [ProfitCenter],
       [FunctionalArea],
       [BusinessArea],
       [Segment],
       [PartnerCostCenter],
       [PartnerProfitCenter],
       [PartnerFunctionalArea],
       [PartnerBusinessArea],
       [PartnerCompany],
       [PartnerSegment],
       [BalanceTransactionCurrency],
       [AmountInBalanceTransacCrcy],
       [TransactionCurrency],
       [AmountInTransactionCurrency],
       [CompanyCodeCurrency],
       [AmountInCompanyCodeCurrency],
       [GlobalCurrency],
       [AmountInGlobalCurrency],
       [FreeDefinedCurrency1],
       [AmountInFreeDefinedCurrency1],
       [FreeDefinedCurrency2],
       [AmountInFreeDefinedCurrency2],
       [BaseUnit],
       [Quantity],
       [DebitCreditCode],
       [FiscalPeriod], 
       [FiscalYearVariant],
       [FiscalYearPeriod],
       [PostingDate],
       [DocumentDate],
       [AccountingDocumentType],
       [AccountingDocumentItem],
       [AssignmentReference],
       [AccountingDocumentCategory],
       [PostingKey],
       [TransactionTypeDetermination],
       [SubLedgerAcctLineItemType],
       [AccountingDocCreatedByUser],
       [LastChangeDateTime],
       [CreationDateTime],
       [CreationDate],
       [OriginObjectType],
       GLAccountLineItemRawData.[GLAccountType],
       [InvoiceReference],
       [InvoiceReferenceFiscalYear],
       [InvoiceItemReference],
       [ReferencePurchaseOrderCategory],
       [PurchasingDocument],
       [PurchasingDocumentItem],
       [AccountAssignmentNumber],
       [DocumentItemText],
       [SalesDocument],
       [SalesDocumentItem],
       [Product],
       [Plant],
       [Supplier],
       [Customer],
       [ExchangeRateDate],                    
       [FinancialAccountType],
       [SpecialGLCode],
       [TaxCode],
       [ClearingDate],
       [ClearingAccountingDocument],
       [ClearingDocFiscalYear],
       [LineItemIsCompleted],
       [PersonnelNumber],
       [PartnerCompanyCode],
       [OriginProfitCenter],
       [OriginCostCenter],
       [AccountAssignment],
       [AccountAssignmentType],
       [CostCtrActivityType],
       [OrderID],
       [OrderCategory],
       [WBSElement],
       [ProjectInternalID],
       [Project],
       [OperatingConcern],
       [BusinessProcess],
       [CostObject],
       [BillableControl],
       [ServiceDocumentType],
       [ServiceDocument],
       [ServiceDocumentItem],
       [BillingDocumentType],
       [SalesOrganization],
       [DistributionChannel],
       GLAccountLineItemRawData.[SalesDistrict],
       [BillToParty],
       [ShipToParty],
       [KMVKBUPA],
       [SoldProduct],
       GLAccountLineItemRawData.[t_applicationId],
       GLAccountLineItemRawData.[t_extractionDtm]
FROM [base_s4h_cax].[I_GLAccountLineItemRawData_202302] GLAccountLineItemRawData 
       UNION ALL
SELECT 
       [SourceLedger],
       [CompanyCode],
       [FiscalYear],
       [AccountingDocument],
       [LedgerGLLineItem],
       [LedgerFiscalYear],
       [GLRecordType],
       [ChartOfAccounts],
       [ControllingArea],
       [FinancialTransactionType],
       [BusinessTransactionType],
       [ControllingBusTransacType],
       [ReferenceDocumentType],
       [ReferenceDocumentContext],
       [ReferenceDocument],
       [ReferenceDocumentItem],
       [ReferenceDocumentItemGroup],
       [IsReversal],
       [IsReversed],
       [PredecessorReferenceDocType],
       [ReversalReferenceDocumentCntxt],
       [ReversalReferenceDocument],
       [IsSettlement],
       [IsSettled],
       [PredecessorReferenceDocument],
       [PredecessorReferenceDocItem],
       [SourceReferenceDocumentType],
       [SourceReferenceDocument],
       [SourceReferenceDocumentItem],
       [IsCommitment],
       [JrnlEntryItemObsoleteReason],
       [GLAccount],
       [CostCenter],
       [ProfitCenter],
       [FunctionalArea],
       [BusinessArea],
       [Segment],
       [PartnerCostCenter],
       [PartnerProfitCenter],
       [PartnerFunctionalArea],
       [PartnerBusinessArea],
       [PartnerCompany],
       [PartnerSegment],
       [BalanceTransactionCurrency],
       [AmountInBalanceTransacCrcy],
       [TransactionCurrency],
       [AmountInTransactionCurrency],
       [CompanyCodeCurrency],
       [AmountInCompanyCodeCurrency],
       [GlobalCurrency],
       [AmountInGlobalCurrency],
       [FreeDefinedCurrency1],
       [AmountInFreeDefinedCurrency1],
       [FreeDefinedCurrency2],
       [AmountInFreeDefinedCurrency2],
       [BaseUnit],
       [Quantity],
       [DebitCreditCode],
       [FiscalPeriod], 
       [FiscalYearVariant],
       [FiscalYearPeriod],
       [PostingDate],
       [DocumentDate],
       [AccountingDocumentType],
       [AccountingDocumentItem],
       [AssignmentReference],
       [AccountingDocumentCategory],
       [PostingKey],
       [TransactionTypeDetermination],
       [SubLedgerAcctLineItemType],
       [AccountingDocCreatedByUser],
       [LastChangeDateTime],
       [CreationDateTime],
       [CreationDate],
       [OriginObjectType],
       GLAccountLineItemRawData.[GLAccountType],
       [InvoiceReference],
       [InvoiceReferenceFiscalYear],
       [InvoiceItemReference],
       [ReferencePurchaseOrderCategory],
       [PurchasingDocument],
       [PurchasingDocumentItem],
       [AccountAssignmentNumber],
       [DocumentItemText],
       [SalesDocument],
       [SalesDocumentItem],
       [Product],
       [Plant],
       [Supplier],
       [Customer],
       [ExchangeRateDate],                    
       [FinancialAccountType],
       [SpecialGLCode],
       [TaxCode],
       [ClearingDate],
       [ClearingAccountingDocument],
       [ClearingDocFiscalYear],
       [LineItemIsCompleted],
       [PersonnelNumber],
       [PartnerCompanyCode],
       [OriginProfitCenter],
       [OriginCostCenter],
       [AccountAssignment],
       [AccountAssignmentType],
       [CostCtrActivityType],
       [OrderID],
       [OrderCategory],
       [WBSElement],
       [ProjectInternalID],
       [Project],
       [OperatingConcern],
       [BusinessProcess],
       [CostObject],
       [BillableControl],
       [ServiceDocumentType],
       [ServiceDocument],
       [ServiceDocumentItem],
       [BillingDocumentType],
       [SalesOrganization],
       [DistributionChannel],
       GLAccountLineItemRawData.[SalesDistrict],
       [BillToParty],
       [ShipToParty],
       [KMVKBUPA],
       [SoldProduct],
       GLAccountLineItemRawData.[t_applicationId],
       GLAccountLineItemRawData.[t_extractionDtm]
FROM [base_s4h_cax].[I_GLAccountLineItemRawData_202303] GLAccountLineItemRawData 
       UNION ALL
SELECT 
       [SourceLedger],
       [CompanyCode],
       [FiscalYear],
       [AccountingDocument],
       [LedgerGLLineItem],
       [LedgerFiscalYear],
       [GLRecordType],
       [ChartOfAccounts],
       [ControllingArea],
       [FinancialTransactionType],
       [BusinessTransactionType],
       [ControllingBusTransacType],
       [ReferenceDocumentType],
       [ReferenceDocumentContext],
       [ReferenceDocument],
       [ReferenceDocumentItem],
       [ReferenceDocumentItemGroup],
       [IsReversal],
       [IsReversed],
       [PredecessorReferenceDocType],
       [ReversalReferenceDocumentCntxt],
       [ReversalReferenceDocument],
       [IsSettlement],
       [IsSettled],
       [PredecessorReferenceDocument],
       [PredecessorReferenceDocItem],
       [SourceReferenceDocumentType],
       [SourceReferenceDocument],
       [SourceReferenceDocumentItem],
       [IsCommitment],
       [JrnlEntryItemObsoleteReason],
       [GLAccount],
       [CostCenter],
       [ProfitCenter],
       [FunctionalArea],
       [BusinessArea],
       [Segment],
       [PartnerCostCenter],
       [PartnerProfitCenter],
       [PartnerFunctionalArea],
       [PartnerBusinessArea],
       [PartnerCompany],
       [PartnerSegment],
       [BalanceTransactionCurrency],
       [AmountInBalanceTransacCrcy],
       [TransactionCurrency],
       [AmountInTransactionCurrency],
       [CompanyCodeCurrency],
       [AmountInCompanyCodeCurrency],
       [GlobalCurrency],
       [AmountInGlobalCurrency],
       [FreeDefinedCurrency1],
       [AmountInFreeDefinedCurrency1],
       [FreeDefinedCurrency2],
       [AmountInFreeDefinedCurrency2],
       [BaseUnit],
       [Quantity],
       [DebitCreditCode],
       [FiscalPeriod], 
       [FiscalYearVariant],
       [FiscalYearPeriod],
       [PostingDate],
       [DocumentDate],
       [AccountingDocumentType],
       [AccountingDocumentItem],
       [AssignmentReference],
       [AccountingDocumentCategory],
       [PostingKey],
       [TransactionTypeDetermination],
       [SubLedgerAcctLineItemType],
       [AccountingDocCreatedByUser],
       [LastChangeDateTime],
       [CreationDateTime],
       [CreationDate],
       [OriginObjectType],
       GLAccountLineItemRawData.[GLAccountType],
       [InvoiceReference],
       [InvoiceReferenceFiscalYear],
       [InvoiceItemReference],
       [ReferencePurchaseOrderCategory],
       [PurchasingDocument],
       [PurchasingDocumentItem],
       [AccountAssignmentNumber],
       [DocumentItemText],
       [SalesDocument],
       [SalesDocumentItem],
       [Product],
       [Plant],
       [Supplier],
       [Customer],
       [ExchangeRateDate],                    
       [FinancialAccountType],
       [SpecialGLCode],
       [TaxCode],
       [ClearingDate],
       [ClearingAccountingDocument],
       [ClearingDocFiscalYear],
       [LineItemIsCompleted],
       [PersonnelNumber],
       [PartnerCompanyCode],
       [OriginProfitCenter],
       [OriginCostCenter],
       [AccountAssignment],
       [AccountAssignmentType],
       [CostCtrActivityType],
       [OrderID],
       [OrderCategory],
       [WBSElement],
       [ProjectInternalID],
       [Project],
       [OperatingConcern],
       [BusinessProcess],
       [CostObject],
       [BillableControl],
       [ServiceDocumentType],
       [ServiceDocument],
       [ServiceDocumentItem],
       [BillingDocumentType],
       [SalesOrganization],
       [DistributionChannel],
       GLAccountLineItemRawData.[SalesDistrict],
       [BillToParty],
       [ShipToParty],
       [KMVKBUPA],
       [SoldProduct],
       GLAccountLineItemRawData.[t_applicationId],
       GLAccountLineItemRawData.[t_extractionDtm]
FROM [base_s4h_cax].[I_GLAccountLineItemRawData_202304] GLAccountLineItemRawData 
       UNION ALL
SELECT 
       [SourceLedger],
       [CompanyCode],
       [FiscalYear],
       [AccountingDocument],
       [LedgerGLLineItem],
       [LedgerFiscalYear],
       [GLRecordType],
       [ChartOfAccounts],
       [ControllingArea],
       [FinancialTransactionType],
       [BusinessTransactionType],
       [ControllingBusTransacType],
       [ReferenceDocumentType],
       [ReferenceDocumentContext],
       [ReferenceDocument],
       [ReferenceDocumentItem],
       [ReferenceDocumentItemGroup],
       [IsReversal],
       [IsReversed],
       [PredecessorReferenceDocType],
       [ReversalReferenceDocumentCntxt],
       [ReversalReferenceDocument],
       [IsSettlement],
       [IsSettled],
       [PredecessorReferenceDocument],
       [PredecessorReferenceDocItem],
       [SourceReferenceDocumentType],
       [SourceReferenceDocument],
       [SourceReferenceDocumentItem],
       [IsCommitment],
       [JrnlEntryItemObsoleteReason],
       [GLAccount],
       [CostCenter],
       [ProfitCenter],
       [FunctionalArea],
       [BusinessArea],
       [Segment],
       [PartnerCostCenter],
       [PartnerProfitCenter],
       [PartnerFunctionalArea],
       [PartnerBusinessArea],
       [PartnerCompany],
       [PartnerSegment],
       [BalanceTransactionCurrency],
       [AmountInBalanceTransacCrcy],
       [TransactionCurrency],
       [AmountInTransactionCurrency],
       [CompanyCodeCurrency],
       [AmountInCompanyCodeCurrency],
       [GlobalCurrency],
       [AmountInGlobalCurrency],
       [FreeDefinedCurrency1],
       [AmountInFreeDefinedCurrency1],
       [FreeDefinedCurrency2],
       [AmountInFreeDefinedCurrency2],
       [BaseUnit],
       [Quantity],
       [DebitCreditCode],
       [FiscalPeriod], 
       [FiscalYearVariant],
       [FiscalYearPeriod],
       [PostingDate],
       [DocumentDate],
       [AccountingDocumentType],
       [AccountingDocumentItem],
       [AssignmentReference],
       [AccountingDocumentCategory],
       [PostingKey],
       [TransactionTypeDetermination],
       [SubLedgerAcctLineItemType],
       [AccountingDocCreatedByUser],
       [LastChangeDateTime],
       [CreationDateTime],
       [CreationDate],
       [OriginObjectType],
       GLAccountLineItemRawData.[GLAccountType],
       [InvoiceReference],
       [InvoiceReferenceFiscalYear],
       [InvoiceItemReference],
       [ReferencePurchaseOrderCategory],
       [PurchasingDocument],
       [PurchasingDocumentItem],
       [AccountAssignmentNumber],
       [DocumentItemText],
       [SalesDocument],
       [SalesDocumentItem],
       [Product],
       [Plant],
       [Supplier],
       [Customer],
       [ExchangeRateDate],                    
       [FinancialAccountType],
       [SpecialGLCode],
       [TaxCode],
       [ClearingDate],
       [ClearingAccountingDocument],
       [ClearingDocFiscalYear],
       [LineItemIsCompleted],
       [PersonnelNumber],
       [PartnerCompanyCode],
       [OriginProfitCenter],
       [OriginCostCenter],
       [AccountAssignment],
       [AccountAssignmentType],
       [CostCtrActivityType],
       [OrderID],
       [OrderCategory],
       [WBSElement],
       [ProjectInternalID],
       [Project],
       [OperatingConcern],
       [BusinessProcess],
       [CostObject],
       [BillableControl],
       [ServiceDocumentType],
       [ServiceDocument],
       [ServiceDocumentItem],
       [BillingDocumentType],
       [SalesOrganization],
       [DistributionChannel],
       GLAccountLineItemRawData.[SalesDistrict],
       [BillToParty],
       [ShipToParty],
       [KMVKBUPA],
       [SoldProduct],
       GLAccountLineItemRawData.[t_applicationId],
       GLAccountLineItemRawData.[t_extractionDtm]
FROM [base_s4h_cax].[I_GLAccountLineItemRawData_202305] GLAccountLineItemRawData 
       UNION ALL
SELECT 
       [SourceLedger],
       [CompanyCode],
       [FiscalYear],
       [AccountingDocument],
       [LedgerGLLineItem],
       [LedgerFiscalYear],
       [GLRecordType],
       [ChartOfAccounts],
       [ControllingArea],
       [FinancialTransactionType],
       [BusinessTransactionType],
       [ControllingBusTransacType],
       [ReferenceDocumentType],
       [ReferenceDocumentContext],
       [ReferenceDocument],
       [ReferenceDocumentItem],
       [ReferenceDocumentItemGroup],
       [IsReversal],
       [IsReversed],
       [PredecessorReferenceDocType],
       [ReversalReferenceDocumentCntxt],
       [ReversalReferenceDocument],
       [IsSettlement],
       [IsSettled],
       [PredecessorReferenceDocument],
       [PredecessorReferenceDocItem],
       [SourceReferenceDocumentType],
       [SourceReferenceDocument],
       [SourceReferenceDocumentItem],
       [IsCommitment],
       [JrnlEntryItemObsoleteReason],
       [GLAccount],
       [CostCenter],
       [ProfitCenter],
       [FunctionalArea],
       [BusinessArea],
       [Segment],
       [PartnerCostCenter],
       [PartnerProfitCenter],
       [PartnerFunctionalArea],
       [PartnerBusinessArea],
       [PartnerCompany],
       [PartnerSegment],
       [BalanceTransactionCurrency],
       [AmountInBalanceTransacCrcy],
       [TransactionCurrency],
       [AmountInTransactionCurrency],
       [CompanyCodeCurrency],
       [AmountInCompanyCodeCurrency],
       [GlobalCurrency],
       [AmountInGlobalCurrency],
       [FreeDefinedCurrency1],
       [AmountInFreeDefinedCurrency1],
       [FreeDefinedCurrency2],
       [AmountInFreeDefinedCurrency2],
       [BaseUnit],
       [Quantity],
       [DebitCreditCode],
       [FiscalPeriod], 
       [FiscalYearVariant],
       [FiscalYearPeriod],
       [PostingDate],
       [DocumentDate],
       [AccountingDocumentType],
       [AccountingDocumentItem],
       [AssignmentReference],
       [AccountingDocumentCategory],
       [PostingKey],
       [TransactionTypeDetermination],
       [SubLedgerAcctLineItemType],
       [AccountingDocCreatedByUser],
       [LastChangeDateTime],
       [CreationDateTime],
       [CreationDate],
       [OriginObjectType],
       GLAccountLineItemRawData.[GLAccountType],
       [InvoiceReference],
       [InvoiceReferenceFiscalYear],
       [InvoiceItemReference],
       [ReferencePurchaseOrderCategory],
       [PurchasingDocument],
       [PurchasingDocumentItem],
       [AccountAssignmentNumber],
       [DocumentItemText],
       [SalesDocument],
       [SalesDocumentItem],
       [Product],
       [Plant],
       [Supplier],
       [Customer],
       [ExchangeRateDate],                    
       [FinancialAccountType],
       [SpecialGLCode],
       [TaxCode],
       [ClearingDate],
       [ClearingAccountingDocument],
       [ClearingDocFiscalYear],
       [LineItemIsCompleted],
       [PersonnelNumber],
       [PartnerCompanyCode],
       [OriginProfitCenter],
       [OriginCostCenter],
       [AccountAssignment],
       [AccountAssignmentType],
       [CostCtrActivityType],
       [OrderID],
       [OrderCategory],
       [WBSElement],
       [ProjectInternalID],
       [Project],
       [OperatingConcern],
       [BusinessProcess],
       [CostObject],
       [BillableControl],
       [ServiceDocumentType],
       [ServiceDocument],
       [ServiceDocumentItem],
       [BillingDocumentType],
       [SalesOrganization],
       [DistributionChannel],
       GLAccountLineItemRawData.[SalesDistrict],
       [BillToParty],
       [ShipToParty],
       [KMVKBUPA],
       [SoldProduct],
       GLAccountLineItemRawData.[t_applicationId],
       GLAccountLineItemRawData.[t_extractionDtm]
FROM [base_s4h_cax].[I_GLAccountLineItemRawData_202306] GLAccountLineItemRawData 
       UNION ALL
SELECT 
       [SourceLedger],
       [CompanyCode],
       [FiscalYear],
       [AccountingDocument],
       [LedgerGLLineItem],
       [LedgerFiscalYear],
       [GLRecordType],
       [ChartOfAccounts],
       [ControllingArea],
       [FinancialTransactionType],
       [BusinessTransactionType],
       [ControllingBusTransacType],
       [ReferenceDocumentType],
       [ReferenceDocumentContext],
       [ReferenceDocument],
       [ReferenceDocumentItem],
       [ReferenceDocumentItemGroup],
       [IsReversal],
       [IsReversed],
       [PredecessorReferenceDocType],
       [ReversalReferenceDocumentCntxt],
       [ReversalReferenceDocument],
       [IsSettlement],
       [IsSettled],
       [PredecessorReferenceDocument],
       [PredecessorReferenceDocItem],
       [SourceReferenceDocumentType],
       [SourceReferenceDocument],
       [SourceReferenceDocumentItem],
       [IsCommitment],
       [JrnlEntryItemObsoleteReason],
       [GLAccount],
       [CostCenter],
       [ProfitCenter],
       [FunctionalArea],
       [BusinessArea],
       [Segment],
       [PartnerCostCenter],
       [PartnerProfitCenter],
       [PartnerFunctionalArea],
       [PartnerBusinessArea],
       [PartnerCompany],
       [PartnerSegment],
       [BalanceTransactionCurrency],
       [AmountInBalanceTransacCrcy],
       [TransactionCurrency],
       [AmountInTransactionCurrency],
       [CompanyCodeCurrency],
       [AmountInCompanyCodeCurrency],
       [GlobalCurrency],
       [AmountInGlobalCurrency],
       [FreeDefinedCurrency1],
       [AmountInFreeDefinedCurrency1],
       [FreeDefinedCurrency2],
       [AmountInFreeDefinedCurrency2],
       [BaseUnit],
       [Quantity],
       [DebitCreditCode],
       [FiscalPeriod], 
       [FiscalYearVariant],
       [FiscalYearPeriod],
       [PostingDate],
       [DocumentDate],
       [AccountingDocumentType],
       [AccountingDocumentItem],
       [AssignmentReference],
       [AccountingDocumentCategory],
       [PostingKey],
       [TransactionTypeDetermination],
       [SubLedgerAcctLineItemType],
       [AccountingDocCreatedByUser],
       [LastChangeDateTime],
       [CreationDateTime],
       [CreationDate],
       [OriginObjectType],
       GLAccountLineItemRawData.[GLAccountType],
       [InvoiceReference],
       [InvoiceReferenceFiscalYear],
       [InvoiceItemReference],
       [ReferencePurchaseOrderCategory],
       [PurchasingDocument],
       [PurchasingDocumentItem],
       [AccountAssignmentNumber],
       [DocumentItemText],
       [SalesDocument],
       [SalesDocumentItem],
       [Product],
       [Plant],
       [Supplier],
       [Customer],
       [ExchangeRateDate],                    
       [FinancialAccountType],
       [SpecialGLCode],
       [TaxCode],
       [ClearingDate],
       [ClearingAccountingDocument],
       [ClearingDocFiscalYear],
       [LineItemIsCompleted],
       [PersonnelNumber],
       [PartnerCompanyCode],
       [OriginProfitCenter],
       [OriginCostCenter],
       [AccountAssignment],
       [AccountAssignmentType],
       [CostCtrActivityType],
       [OrderID],
       [OrderCategory],
       [WBSElement],
       [ProjectInternalID],
       [Project],
       [OperatingConcern],
       [BusinessProcess],
       [CostObject],
       [BillableControl],
       [ServiceDocumentType],
       [ServiceDocument],
       [ServiceDocumentItem],
       [BillingDocumentType],
       [SalesOrganization],
       [DistributionChannel],
       GLAccountLineItemRawData.[SalesDistrict],
       [BillToParty],
       [ShipToParty],
       [KMVKBUPA],
       [SoldProduct],
       GLAccountLineItemRawData.[t_applicationId],
       GLAccountLineItemRawData.[t_extractionDtm]
FROM [base_s4h_cax].[I_GLAccountLineItemRawData_202307] GLAccountLineItemRawData 
       UNION ALL
SELECT 
       [SourceLedger],
       [CompanyCode],
       [FiscalYear],
       [AccountingDocument],
       [LedgerGLLineItem],
       [LedgerFiscalYear],
       [GLRecordType],
       [ChartOfAccounts],
       [ControllingArea],
       [FinancialTransactionType],
       [BusinessTransactionType],
       [ControllingBusTransacType],
       [ReferenceDocumentType],
       [ReferenceDocumentContext],
       [ReferenceDocument],
       [ReferenceDocumentItem],
       [ReferenceDocumentItemGroup],
       [IsReversal],
       [IsReversed],
       [PredecessorReferenceDocType],
       [ReversalReferenceDocumentCntxt],
       [ReversalReferenceDocument],
       [IsSettlement],
       [IsSettled],
       [PredecessorReferenceDocument],
       [PredecessorReferenceDocItem],
       [SourceReferenceDocumentType],
       [SourceReferenceDocument],
       [SourceReferenceDocumentItem],
       [IsCommitment],
       [JrnlEntryItemObsoleteReason],
       [GLAccount],
       [CostCenter],
       [ProfitCenter],
       [FunctionalArea],
       [BusinessArea],
       [Segment],
       [PartnerCostCenter],
       [PartnerProfitCenter],
       [PartnerFunctionalArea],
       [PartnerBusinessArea],
       [PartnerCompany],
       [PartnerSegment],
       [BalanceTransactionCurrency],
       [AmountInBalanceTransacCrcy],
       [TransactionCurrency],
       [AmountInTransactionCurrency],
       [CompanyCodeCurrency],
       [AmountInCompanyCodeCurrency],
       [GlobalCurrency],
       [AmountInGlobalCurrency],
       [FreeDefinedCurrency1],
       [AmountInFreeDefinedCurrency1],
       [FreeDefinedCurrency2],
       [AmountInFreeDefinedCurrency2],
       [BaseUnit],
       [Quantity],
       [DebitCreditCode],
       [FiscalPeriod], 
       [FiscalYearVariant],
       [FiscalYearPeriod],
       [PostingDate],
       [DocumentDate],
       [AccountingDocumentType],
       [AccountingDocumentItem],
       [AssignmentReference],
       [AccountingDocumentCategory],
       [PostingKey],
       [TransactionTypeDetermination],
       [SubLedgerAcctLineItemType],
       [AccountingDocCreatedByUser],
       [LastChangeDateTime],
       [CreationDateTime],
       [CreationDate],
       [OriginObjectType],
       GLAccountLineItemRawData.[GLAccountType],
       [InvoiceReference],
       [InvoiceReferenceFiscalYear],
       [InvoiceItemReference],
       [ReferencePurchaseOrderCategory],
       [PurchasingDocument],
       [PurchasingDocumentItem],
       [AccountAssignmentNumber],
       [DocumentItemText],
       [SalesDocument],
       [SalesDocumentItem],
       [Product],
       [Plant],
       [Supplier],
       [Customer],
       [ExchangeRateDate],                    
       [FinancialAccountType],
       [SpecialGLCode],
       [TaxCode],
       [ClearingDate],
       [ClearingAccountingDocument],
       [ClearingDocFiscalYear],
       [LineItemIsCompleted],
       [PersonnelNumber],
       [PartnerCompanyCode],
       [OriginProfitCenter],
       [OriginCostCenter],
       [AccountAssignment],
       [AccountAssignmentType],
       [CostCtrActivityType],
       [OrderID],
       [OrderCategory],
       [WBSElement],
       [ProjectInternalID],
       [Project],
       [OperatingConcern],
       [BusinessProcess],
       [CostObject],
       [BillableControl],
       [ServiceDocumentType],
       [ServiceDocument],
       [ServiceDocumentItem],
       [BillingDocumentType],
       [SalesOrganization],
       [DistributionChannel],
       GLAccountLineItemRawData.[SalesDistrict],
       [BillToParty],
       [ShipToParty],
       [KMVKBUPA],
       [SoldProduct],
       GLAccountLineItemRawData.[t_applicationId],
       GLAccountLineItemRawData.[t_extractionDtm]
FROM [base_s4h_cax].[I_GLAccountLineItemRawData_202308] GLAccountLineItemRawData 
       UNION ALL
SELECT 
       [SourceLedger],
       [CompanyCode],
       [FiscalYear],
       [AccountingDocument],
       [LedgerGLLineItem],
       [LedgerFiscalYear],
       [GLRecordType],
       [ChartOfAccounts],
       [ControllingArea],
       [FinancialTransactionType],
       [BusinessTransactionType],
       [ControllingBusTransacType],
       [ReferenceDocumentType],
       [ReferenceDocumentContext],
       [ReferenceDocument],
       [ReferenceDocumentItem],
       [ReferenceDocumentItemGroup],
       [IsReversal],
       [IsReversed],
       [PredecessorReferenceDocType],
       [ReversalReferenceDocumentCntxt],
       [ReversalReferenceDocument],
       [IsSettlement],
       [IsSettled],
       [PredecessorReferenceDocument],
       [PredecessorReferenceDocItem],
       [SourceReferenceDocumentType],
       [SourceReferenceDocument],
       [SourceReferenceDocumentItem],
       [IsCommitment],
       [JrnlEntryItemObsoleteReason],
       [GLAccount],
       [CostCenter],
       [ProfitCenter],
       [FunctionalArea],
       [BusinessArea],
       [Segment],
       [PartnerCostCenter],
       [PartnerProfitCenter],
       [PartnerFunctionalArea],
       [PartnerBusinessArea],
       [PartnerCompany],
       [PartnerSegment],
       [BalanceTransactionCurrency],
       [AmountInBalanceTransacCrcy],
       [TransactionCurrency],
       [AmountInTransactionCurrency],
       [CompanyCodeCurrency],
       [AmountInCompanyCodeCurrency],
       [GlobalCurrency],
       [AmountInGlobalCurrency],
       [FreeDefinedCurrency1],
       [AmountInFreeDefinedCurrency1],
       [FreeDefinedCurrency2],
       [AmountInFreeDefinedCurrency2],
       [BaseUnit],
       [Quantity],
       [DebitCreditCode],
       [FiscalPeriod], 
       [FiscalYearVariant],
       [FiscalYearPeriod],
       [PostingDate],
       [DocumentDate],
       [AccountingDocumentType],
       [AccountingDocumentItem],
       [AssignmentReference],
       [AccountingDocumentCategory],
       [PostingKey],
       [TransactionTypeDetermination],
       [SubLedgerAcctLineItemType],
       [AccountingDocCreatedByUser],
       [LastChangeDateTime],
       [CreationDateTime],
       [CreationDate],
       [OriginObjectType],
       GLAccountLineItemRawData.[GLAccountType],
       [InvoiceReference],
       [InvoiceReferenceFiscalYear],
       [InvoiceItemReference],
       [ReferencePurchaseOrderCategory],
       [PurchasingDocument],
       [PurchasingDocumentItem],
       [AccountAssignmentNumber],
       [DocumentItemText],
       [SalesDocument],
       [SalesDocumentItem],
       [Product],
       [Plant],
       [Supplier],
       [Customer],
       [ExchangeRateDate],                    
       [FinancialAccountType],
       [SpecialGLCode],
       [TaxCode],
       [ClearingDate],
       [ClearingAccountingDocument],
       [ClearingDocFiscalYear],
       [LineItemIsCompleted],
       [PersonnelNumber],
       [PartnerCompanyCode],
       [OriginProfitCenter],
       [OriginCostCenter],
       [AccountAssignment],
       [AccountAssignmentType],
       [CostCtrActivityType],
       [OrderID],
       [OrderCategory],
       [WBSElement],
       [ProjectInternalID],
       [Project],
       [OperatingConcern],
       [BusinessProcess],
       [CostObject],
       [BillableControl],
       [ServiceDocumentType],
       [ServiceDocument],
       [ServiceDocumentItem],
       [BillingDocumentType],
       [SalesOrganization],
       [DistributionChannel],
       GLAccountLineItemRawData.[SalesDistrict],
       [BillToParty],
       [ShipToParty],
       [KMVKBUPA],
       [SoldProduct],
       GLAccountLineItemRawData.[t_applicationId],
       GLAccountLineItemRawData.[t_extractionDtm]
FROM [base_s4h_cax].[I_GLAccountLineItemRawData_202309] GLAccountLineItemRawData 
),

SalesReferenceDocumentCalculated AS (
SELECT  
       GLA.[SourceLedgerID],
       GLA.[CompanyCodeID], 
       GLA.[FiscalYear],
       GLA.[AccountingDocument], 
       GLA.[LedgerGLLineItem],
       GLA.SalesDocumentID,
       GLA.SalesDocumentItemID,
       edw.svf_getSalesDoc(GLA.SalesDocumentID,DPF.SubsequentDocument,PF.PrecedingDocument) AS SalesReferenceDocumentCalculated,
       edw.svf_getSalesDocItem(GLA.SalesDocumentID,GLA.SalesDocumentItemID,DPF.SubsequentDocumentItem,PF.PrecedingDocumentItem) AS SalesReferenceDocumentItemCalculated
FROM GLAccountLineItemRawData AS GLA
LEFT JOIN [base_s4h_cax].[I_SDDocumentProcessFlow] DPF
    ON
       GLA.SalesDocumentID = DPF.PrecedingDocument COLLATE DATABASE_DEFAULT 
       AND
       GLA.SalesDocumentItemID = DPF.PrecedingDocumentItem COLLATE DATABASE_DEFAULT 
       AND
       DPF.SubsequentDocumentCategory = 'C'
LEFT JOIN [base_s4h_cax].[I_SDDocumentProcessFlow] AS PF
    ON
       GLA.SalesDocumentID = PF.SubsequentDocument COLLATE DATABASE_DEFAULT 
       AND
       GLA.SalesDocumentItemID = PF.SubsequentDocumentItem COLLATE DATABASE_DEFAULT 
       AND
       PF.PrecedingDocumentCategory IN ('C', 'I')
),

SalesReferenceDocumentUnique AS (
SELECT
       [SourceLedgerID],
       [CompanyCodeID], 
       [FiscalYear],
       [AccountingDocument], 
       [LedgerGLLineItem],
       [SalesReferenceDocumentCalculated],
       [SalesReferenceDocumentItemCalculated]
FROM SalesReferenceDocumentCalculated 
GROUP BY
       [SourceLedgerID],
       [CompanyCodeID], 
       [FiscalYear],
       [AccountingDocument], 
       [LedgerGLLineItem],
       [SalesReferenceDocumentCalculated],
       [SalesReferenceDocumentItemCalculated]
)

SELECT 
       GLA.[SourceLedgerID],
       GLA.[CompanyCodeID],
       edw.svf_getProductSurrogateKey(VC.[ProductSurrogateKey],GLA.[ProductID],SoldProduct) AS [ProductSurrogateKey],
       GLA.[FiscalYear],
       GLA.[AccountingDocument],
       GLA.[LedgerGLLineItem],
       [LedgerFiscalYear],
       [GLRecordTypeID],
       [ChartOfAccountsID],
       [ControllingAreaID],
       [FinancialTransactionTypeID],
       [BusinessTransactionTypeID],
       [ControllingBusTransacTypeID],
       [ReferenceDocumentTypeID],
       [ReferenceDocumentContextID],
       [ReferenceDocument],
       [ReferenceDocumentItem],
       [ReferenceDocumentItemGroupID],
       [IsReversal],
       [IsReversed],
       [PredecessorReferenceDocTypeID],
       [ReversalReferenceDocumentCntxtID],
       [ReversalReferenceDocument],
       [IsSettlement],
       [IsSettled],
       [PredecessorReferenceDocument],
       [PredecessorReferenceDocItem],
       [SourceReferenceDocumentTypeID],
       [SourceReferenceDocument],
       [SourceReferenceDocumentItem],
       [IsCommitment],
       [JrnlEntryItemObsoleteReasonID],
       GLA.[GLAccountID],
       GLA.[CostCenterID],
       GLA.[ProfitCenterID],
       [FunctionalAreaID],
       [BusinessAreaID],          
       [SegmentID],
       [PartnerCostCenterID],
       [PartnerProfitCenterID],
       [PartnerFunctionalAreaID],
       [PartnerBusinessAreaID],
       [PartnerCompanyID],
       [PartnerSegmentID],
       [BalanceTransactionCurrency],
       [AmountInBalanceTransacCrcy],
       [TransactionCurrency],
       [AmountInTransactionCurrency],
       [CompanyCodeCurrency],
       [AmountInCompanyCodeCurrency],
       [GlobalCurrency],
       [AmountInGlobalCurrency],
       [FreeDefinedCurrency1],
       [AmountInFreeDefinedCurrency1],
       [FreeDefinedCurrency2],
       [AmountInFreeDefinedCurrency2],
       GLA.[BaseUnit],
       [Quantity],
       [DebitCreditID], 
       GLA.[FiscalPeriod], 
       GLA.[FiscalYearVariant],
       [FiscalYearPeriod],
       [PostingDate],
       [DocumentDate],
       [AccountingDocumentTypeID],
       [AccountingDocumentItem],
       [AssignmentReference],
       [AccountingDocumentCategoryID],
       [PostingKeyID],
       [TransactionTypeDeterminationID],
       [SubLedgerAcctLineItemTypeID],
       [AccountingDocCreatedByUserID],
       [LastChangeDateTime],
       [CreationDateTime],
       GLA.[CreationDate],
       [OriginObjectTypeID],
       [GLAccountTypeID],
       [InvoiceReference],
       [InvoiceReferenceFiscalYear],
       [InvoiceItemReference],
       [ReferencePurchaseOrderCategoryID],
       [PurchasingDocument],
       [PurchasingDocumentItem],
       [AccountAssignmentNumber],
       [DocumentItemText],
       GLA.[SalesDocumentID],          
       GLA.[SalesDocumentItemID],
       GLA.[ProductID],
       GLA.[PlantID],
       [SupplierID],
       [CustomerID],
       [ExchangeRateDate],                    
       [FinancialAccountTypeID],
       [SpecialGLCodeID],
       [TaxCodeID],
       [ClearingDate],
       [ClearingAccountingDocument],
       [ClearingDocFiscalYear],
       [LineItemIsCompleted],
       [PersonnelNumber],
       [PartnerCompanyCodeID],
       [OriginProfitCenterID],
       [OriginCostCenterID],
       [AccountAssignmentID],
       [AccountAssignmentTypeID],
       [CostCtrActivityTypeID],
       GLA.[OrderID],
       [OrderCategoryID],
       [WBSElementID],
       [ProjectInternalID],
       GLA.[ProjectID],
       [OperatingConcernID],
       [BusinessProcessID],
       [CostObjectID],
       [BillableControlID],
       [ServiceDocumentTypeID],
       [ServiceDocument],
       [ServiceDocumentItem],
       GLA.[BillingDocumentTypeID],
       GLA.[SalesOrganizationID],
       GLA.[DistributionChannelID],
       GLA.[SalesDistrictID],
       [BillToPartyID],
       [ShipToPartyID], 
       GLA.[SalesOfficeID],
       PA.ICSalesDocumentID,
       PA.ICSalesDocumentItemID,
       [SoldProduct],
       ProfitCenterTypeID,
       SRDU.[SalesReferenceDocumentCalculated],
       SRDU.[SalesReferenceDocumentItemCalculated],
       BDI.[SalesDocumentItemCategoryID], 
       BDI.[HigherLevelItem],
       GLA.[t_applicationId],
       GLA.[t_extractionDtm]
FROM GLAccountLineItemRawData AS GLA
LEFT JOIN PA
    ON
        PA.PurchaseOrder COLLATE DATABASE_DEFAULT = [PurchasingDocument]
    AND
        PA.PurchaseOrderItem = [PurchasingDocumentItem]
LEFT JOIN [edw].[vw_ProductHierarchyVariantConfigCharacteristic] AS VC
    ON
        VC.SalesDocument = CASE
            WHEN [ReferenceDocumentTypeID] = 'VBRK' AND GLA.SalesDocumentID = ''
            THEN PA.ICSalesDocumentID COLLATE DATABASE_DEFAULT
            ELSE GLA.SalesDocumentID
        END
    AND
        VC.SalesDocumentItem = CASE
            WHEN [ReferenceDocumentTypeID] = 'VBRK' AND GLA.SalesDocumentID = ''
            THEN PA.ICSalesDocumentItemID COLLATE DATABASE_DEFAULT
            ELSE GLA.SalesDocumentItemID
        END 
LEFT JOIN edw.dim_ProfitCenter PC
    ON 
        GLA.ProfitCenterID=PC.ProfitCenterID
LEFT JOIN SalesReferenceDocumentUnique AS SRDU
    ON GLA.[SourceLedgerID] = SRDU.[SourceLedgerID] 
       AND GLA.[CompanyCodeID]= SRDU.[CompanyCodeID]
       AND GLA.[FiscalYear]= SRDU.[FiscalYear]
       AND GLA.[AccountingDocument]= SRDU.[AccountingDocument]
       AND GLA.[LedgerGLLineItem]= SRDU.[LedgerGLLineItem]
LEFT JOIN [edw].[fact_BillingDocumentItem] BDI 
    ON GLA.ReferenceDocument = BDI.BillingDocument 
       AND GLA.ReferenceDocumentItem = BDI.BillingDocumentItem
       AND BDI.CurrencyTypeID = '10'

-- WHERE
--     GLAccountLineItemRawData.MANDT = 200 MPS 2021/11/01: commented out due to different client values between dev,qas, and prod

