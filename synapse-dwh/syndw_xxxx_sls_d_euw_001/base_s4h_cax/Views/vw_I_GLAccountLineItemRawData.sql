CREATE VIEW [base_s4h_cax].[vw_I_GLAccountLineItemRawData]
AS
with last_rows as (
    select max([TS_SEQUENCE_NUMBER]) as TS_SEQUENCE_NUMBER,
           max([t_extractionDtm])    as [t_extractionDtm],
           [MANDT], [SourceLedger], [CompanyCode], [FiscalYear], [AccountingDocument], [LedgerGLLineItem]

    from [base_s4h_cax].[I_GLAccountLineItemRawData_delta]
    group by [MANDT],  [SourceLedger], [CompanyCode], [FiscalYear], [AccountingDocument], [LedgerGLLineItem]
)
select 
        current_rows.[MANDT]
    ,   current_rows.[ODQ_CHANGEMODE]
    ,   current_rows.[ODQ_ENTITYCNTR]
    ,   current_rows.[SourceLedger]
    ,   current_rows.[CompanyCode]
    ,   current_rows.[FiscalYear]
    ,   current_rows.[AccountingDocument]
    ,   current_rows.[LedgerGLLineItem]
    ,   current_rows.[LedgerFiscalYear]
    ,   current_rows.[GLRecordType]
    ,   current_rows.[ChartOfAccounts]
    ,   current_rows.[ControllingArea]
    ,   current_rows.[FinancialTransactionType]
    ,   current_rows.[BusinessTransactionType]
    ,   current_rows.[ControllingBusTransacType]
    ,   current_rows.[ReferenceDocumentType]
    ,   current_rows.[LogicalSystem]
    ,   current_rows.[ReferenceDocumentContext]
    ,   current_rows.[ReferenceDocument]
    ,   current_rows.[ReferenceDocumentItem]
    ,   current_rows.[ReferenceDocumentItemGroup]
    ,   current_rows.[IsReversal]
    ,   current_rows.[IsReversed]
    ,   current_rows.[ReversalReferenceDocumentCntxt]
    ,   current_rows.[ReversalReferenceDocument]
    ,   current_rows.[IsSettlement]
    ,   current_rows.[IsSettled]
    ,   current_rows.[PredecessorReferenceDocType]
    ,   current_rows.[PredecessorReferenceDocCntxt]
    ,   current_rows.[PredecessorReferenceDocument]
    ,   current_rows.[PredecessorReferenceDocItem]
    ,   current_rows.[SourceReferenceDocumentType]
    ,   current_rows.[SourceLogicalSystem]
    ,   current_rows.[SourceReferenceDocumentCntxt]
    ,   current_rows.[SourceReferenceDocument]
    ,   current_rows.[SourceReferenceDocumentItem]
    ,   current_rows.[SourceReferenceDocSubitem]
    ,   current_rows.[IsCommitment]
    ,   current_rows.[JrnlEntryItemObsoleteReason]
    ,   current_rows.[GLAccount]
    ,   current_rows.[CostCenter]
    ,   current_rows.[ProfitCenter]
    ,   current_rows.[FunctionalArea]
    ,   current_rows.[BusinessArea]
    ,   current_rows.[Segment]
    ,   current_rows.[PartnerCostCenter]
    ,   current_rows.[PartnerProfitCenter]
    ,   current_rows.[PartnerFunctionalArea]
    ,   current_rows.[PartnerBusinessArea]
    ,   current_rows.[PartnerCompany]
    ,   current_rows.[PartnerSegment]
    ,   current_rows.[BalanceTransactionCurrency]
    ,   current_rows.[AmountInBalanceTransacCrcy]
    ,   current_rows.[TransactionCurrency]
    ,   current_rows.[AmountInTransactionCurrency]
    ,   current_rows.[CompanyCodeCurrency]
    ,   current_rows.[AmountInCompanyCodeCurrency]
    ,   current_rows.[GlobalCurrency]
    ,   current_rows.[AmountInGlobalCurrency]
    ,   current_rows.[FreeDefinedCurrency1]
    ,   current_rows.[AmountInFreeDefinedCurrency1]
    ,   current_rows.[FreeDefinedCurrency2]
    ,   current_rows.[AmountInFreeDefinedCurrency2]
    ,   current_rows.[FreeDefinedCurrency3]
    ,   current_rows.[AmountInFreeDefinedCurrency3]
    ,   current_rows.[FreeDefinedCurrency4]
    ,   current_rows.[AmountInFreeDefinedCurrency4]
    ,   current_rows.[FreeDefinedCurrency5]
    ,   current_rows.[AmountInFreeDefinedCurrency5]
    ,   current_rows.[FreeDefinedCurrency6]
    ,   current_rows.[AmountInFreeDefinedCurrency6]
    ,   current_rows.[FreeDefinedCurrency7]
    ,   current_rows.[AmountInFreeDefinedCurrency7]
    ,   current_rows.[FreeDefinedCurrency8]
    ,   current_rows.[AmountInFreeDefinedCurrency8]
    ,   current_rows.[FixedAmountInGlobalCrcy]
    ,   current_rows.[GrpValnFixedAmtInGlobCrcy]
    ,   current_rows.[PrftCtrValnFxdAmtInGlobCrcy]
    ,   current_rows.[FixedAmountInCoCoDeCrcy]
    ,   current_rows.[TotalPriceVarcInGlobalCrcy]
    ,   current_rows.[GrpValnTotPrcVarcInGlobCrcy]
    ,   current_rows.[PrftCtrValnTotPrcVarcInGlbCrcy]
    ,   current_rows.[FixedPriceVarcInGlobalCrcy]
    ,   current_rows.[GrpValnFixedPrcVarcInGlobCrcy]
    ,   current_rows.[PrftCtrValnFxdPrcVarcInGlbCrcy]
    ,   current_rows.[ControllingObjectCurrency]
    ,   current_rows.[AmountInObjectCurrency]
    ,   current_rows.[BaseUnit]
    ,   current_rows.[Quantity]
    ,   current_rows.[FixedQuantity]
    ,   current_rows.[CostSourceUnit]
    ,   current_rows.[ValuationQuantity]
    ,   current_rows.[ValuationFixedQuantity]
    ,   current_rows.[AdditionalQuantity1Unit]
    ,   current_rows.[AdditionalQuantity1]
    ,   current_rows.[AdditionalQuantity2Unit]
    ,   current_rows.[AdditionalQuantity2]
    ,   current_rows.[AdditionalQuantity3Unit]
    ,   current_rows.[AdditionalQuantity3]
    ,   current_rows.[DebitCreditCode]
    ,   current_rows.[FiscalPeriod]
    ,   current_rows.[FiscalYearVariant]
    ,   current_rows.[FiscalYearPeriod]
    ,   current_rows.[PostingDate]
    ,   current_rows.[DocumentDate]
    ,   current_rows.[AccountingDocumentType]
    ,   current_rows.[AccountingDocumentItem]
    ,   current_rows.[AssignmentReference]
    ,   current_rows.[AccountingDocumentCategory]
    ,   current_rows.[PostingKey]
    ,   current_rows.[TransactionTypeDetermination]
    ,   current_rows.[SubLedgerAcctLineItemType]
    ,   current_rows.[AccountingDocCreatedByUser]
    ,   current_rows.[LastChangeDateTime]
    ,   current_rows.[CreationDateTime]
    ,   current_rows.[CreationDate]
    ,   current_rows.[EliminationProfitCenter]
    ,   current_rows.[OriginObjectType]
    ,   current_rows.[GLAccountType]
    ,   current_rows.[AlternativeGLAccount]
    ,   current_rows.[CountryChartOfAccounts]
    ,   current_rows.[InvoiceReference]
    ,   current_rows.[InvoiceReferenceFiscalYear]
    ,   current_rows.[FollowOnDocumentType]
    ,   current_rows.[InvoiceItemReference]
    ,   current_rows.[ReferencePurchaseOrderCategory]
    ,   current_rows.[PurchasingDocument]
    ,   current_rows.[PurchasingDocumentItem]
    ,   current_rows.[AccountAssignmentNumber]
    ,   current_rows.[DocumentItemText]
    ,   current_rows.[SalesDocument]
    ,   current_rows.[SalesDocumentItem]
    ,   current_rows.[Product]
    ,   current_rows.[Plant]
    ,   current_rows.[Supplier]
    ,   current_rows.[Customer]
    ,   current_rows.[ServicesRenderedDate]
    ,   current_rows.[ConditionContract]
    ,   current_rows.[ExchangeRateDate]
    ,   current_rows.[FinancialAccountType]
    ,   current_rows.[SpecialGLCode]
    ,   current_rows.[TaxCode]
    ,   current_rows.[HouseBank]
    ,   current_rows.[HouseBankAccount]
    ,   current_rows.[IsOpenItemManaged]
    ,   current_rows.[ClearingDate]
    ,   current_rows.[ClearingAccountingDocument]
    ,   current_rows.[ClearingDocFiscalYear]
    ,   current_rows.[AssetDepreciationArea]
    ,   current_rows.[MasterFixedAsset]
    ,   current_rows.[FixedAsset]
    ,   current_rows.[AssetValueDate]
    ,   current_rows.[AssetTransactionType]
    ,   current_rows.[AssetAcctTransClassfctn]
    ,   current_rows.[DepreciationFiscalPeriod]
    ,   current_rows.[GroupMasterFixedAsset]
    ,   current_rows.[GroupFixedAsset]
    ,   current_rows.[AssetClass]
    ,   current_rows.[CostEstimate]
    ,   current_rows.[InventorySpecialStockValnType]
    ,   current_rows.[InventorySpecialStockType]
    ,   current_rows.[InventorySpclStkSalesDocument]
    ,   current_rows.[InventorySpclStkSalesDocItm]
    ,   current_rows.[InvtrySpclStockWBSElmntIntID]
    ,   current_rows.[InventorySpclStockWBSElement]
    ,   current_rows.[InventorySpecialStockSupplier]
    ,   current_rows.[InventoryValuationType]
    ,   current_rows.[ValuationArea]
    ,   current_rows.[SenderCompanyCode]
    ,   current_rows.[SenderGLAccount]
    ,   current_rows.[SenderAccountAssignment]
    ,   current_rows.[SenderAccountAssignmentType]
    ,   current_rows.[ControllingObject]
    ,   current_rows.[CostOriginGroup]
    ,   current_rows.[OriginSenderObject]
    ,   current_rows.[ControllingDebitCreditCode]
    ,   current_rows.[ControllingObjectDebitType]
    ,   current_rows.[QuantityIsIncomplete]
    ,   current_rows.[OffsettingAccount]
    ,   current_rows.[OffsettingAccountType]
    ,   current_rows.[OffsettingChartOfAccounts]
    ,   current_rows.[LineItemIsCompleted]
    ,   current_rows.[PersonnelNumber]
    ,   current_rows.[ControllingObjectClass]
    ,   current_rows.[PartnerCompanyCode]
    ,   current_rows.[PartnerControllingObjectClass]
    ,   current_rows.[OriginCostCenter]
    ,   current_rows.[OriginProfitCenter]
    ,   current_rows.[OriginCostCtrActivityType]
    ,   current_rows.[AccountAssignment]
    ,   current_rows.[AccountAssignmentType]
    ,   current_rows.[CostCtrActivityType]
    ,   current_rows.[OrderID]
    ,   current_rows.[OrderCategory]
    ,   current_rows.[WBSElementInternalID]
    ,   current_rows.[WBSElement]
    ,   current_rows.[PartnerWBSElementInternalID]
    ,   current_rows.[PartnerWBSElement]
    ,   current_rows.[ProjectInternalID]
    ,   current_rows.[Project]
    ,   current_rows.[PartnerProjectInternalID]
    ,   current_rows.[PartnerProject]
    ,   current_rows.[OperatingConcern]
    ,   current_rows.[ProjectNetwork]
    ,   current_rows.[RelatedNetworkActivity]
    ,   current_rows.[BusinessProcess]
    ,   current_rows.[CostObject]
    ,   current_rows.[BillableControl]
    ,   current_rows.[CostAnalysisResource]
    ,   current_rows.[CustomerServiceNotification]
    ,   current_rows.[ServiceDocumentType]
    ,   current_rows.[ServiceDocument]
    ,   current_rows.[ServiceDocumentItem]
    ,   current_rows.[PartnerServiceDocumentType]
    ,   current_rows.[PartnerServiceDocument]
    ,   current_rows.[PartnerServiceDocumentItem]
    ,   current_rows.[ServiceContractType]
    ,   current_rows.[ServiceContract]
    ,   current_rows.[ServiceContractItem]
    ,   current_rows.[TimeSheetOvertimeCategory]
    ,   current_rows.[PartnerAccountAssignment]
    ,   current_rows.[PartnerAccountAssignmentType]
    ,   current_rows.[WorkPackage]
    ,   current_rows.[WorkItem]
    ,   current_rows.[PartnerCostCtrActivityType]
    ,   current_rows.[PartnerOrder]
    ,   current_rows.[PartnerOrderCategory]
    ,   current_rows.[PartnerSalesDocument]
    ,   current_rows.[PartnerSalesDocumentItem]
    ,   current_rows.[PartnerProjectNetwork]
    ,   current_rows.[PartnerProjectNetworkActivity]
    ,   current_rows.[PartnerBusinessProcess]
    ,   current_rows.[PartnerCostObject]
    ,   current_rows.[BillingDocumentType]
    ,   current_rows.[SalesOrganization]
    ,   current_rows.[DistributionChannel]
    ,   current_rows.[OrganizationDivision]
    ,   current_rows.[SoldProduct]
    ,   current_rows.[SoldProductGroup]
    ,   current_rows.[CustomerGroup]
    ,   current_rows.[CustomerSupplierCountry]
    ,   current_rows.[CustomerSupplierIndustry]
    ,   current_rows.[SalesDistrict]
    ,   current_rows.[BillToParty]
    ,   current_rows.[ShipToParty]
    ,   current_rows.[CustomerSupplierCorporateGroup]
    ,   current_rows.[CashLedgerCompanyCode]
    ,   current_rows.[CashLedgerAccount]
    ,   current_rows.[FinancialManagementArea]
    ,   current_rows.[FundsCenter]
    ,   current_rows.[FundedProgram]
    ,   current_rows.[Fund]
    ,   current_rows.[GrantID]
    ,   current_rows.[BudgetPeriod]
    ,   current_rows.[PartnerFund]
    ,   current_rows.[PartnerGrant]
    ,   current_rows.[PartnerBudgetPeriod]
    ,   current_rows.[PubSecBudgetAccount]
    ,   current_rows.[PubSecBudgetAccountCoCode]
    ,   current_rows.[PubSecBudgetCnsmpnDate]
    ,   current_rows.[PubSecBudgetCnsmpnFsclPeriod]
    ,   current_rows.[PubSecBudgetCnsmpnFsclYear]
    ,   current_rows.[PubSecBudgetIsRelevant]
    ,   current_rows.[PubSecBudgetCnsmpnType]
    ,   current_rows.[PubSecBudgetCnsmpnAmtType]
    ,   current_rows.[JointVenture]
    ,   current_rows.[JointVentureEquityGroup]
    ,   current_rows.[JointVentureCostRecoveryCode]
    ,   current_rows.[JointVenturePartner]
    ,   current_rows.[JointVentureBillingType]
    ,   current_rows.[JointVentureEquityType]
    ,   current_rows.[JointVentureProductionDate]
    ,   current_rows.[JointVentureBillingDate]
    ,   current_rows.[JointVentureOperationalDate]
    ,   current_rows.[CutbackRun]
    ,   current_rows.[JointVentureAccountingActivity]
    ,   current_rows.[PartnerVenture]
    ,   current_rows.[PartnerEquityGroup]
    ,   current_rows.[SenderCostRecoveryCode]
    ,   current_rows.[CutbackAccount]
    ,   current_rows.[CutbackCostObject]
    ,   current_rows.[SettlementReferenceDate]
    ,   current_rows.[AccrualObjectType]
    ,   current_rows.[AccrualObject]
    ,   current_rows.[AccrualSubobject]
    ,   current_rows.[AccrualItemType]
    ,   current_rows.[AccrualValueDate]
    ,   current_rows.[FinancialValuationObjectType]
    ,   current_rows.[FinancialValuationObject]
    ,   current_rows.[FinancialValuationSubobject]
    ,   current_rows.[NetDueDate]
    ,   current_rows.[CreditRiskClass]
    ,   current_rows.[WorkCenterInternalID]
    ,   current_rows.[OrderOperation]
    ,   current_rows.[OrderItem]
    ,   current_rows.[OrderSuboperation]
    ,   current_rows.[Equipment]
    ,   current_rows.[FunctionalLocation]
    ,   current_rows.[Assembly]
    ,   current_rows.[MaintenanceActivityType]
    ,   current_rows.[MaintenanceOrderPlanningCode]
    ,   current_rows.[MaintPriorityType]
    ,   current_rows.[MaintPriority]
    ,   current_rows.[SuperiorOrder]
    ,   current_rows.[ProductGroup]
    ,   current_rows.[MaintenanceOrderIsPlanned] 
    ,   current_rows.[t_applicationId]
    ,   current_rows.[t_jobId]
    ,   current_rows.[t_jobDtm]
    ,   current_rows.[t_jobBy]
    ,   current_rows.[t_extractionDtm]
    ,   current_rows.[t_filePath]
from last_rows
join [base_s4h_cax].[I_GLAccountLineItemRawData_delta] current_rows on
        current_rows.[TS_SEQUENCE_NUMBER] = last_rows.[TS_SEQUENCE_NUMBER]
        AND
         current_rows.[t_extractionDtm] = last_rows.[t_extractionDtm]
        AND
         current_rows.[MANDT] = last_rows.[MANDT]
        AND
         current_rows.[SourceLedger] = last_rows.[SourceLedger]
        AND
         current_rows.[CompanyCode] = last_rows.[CompanyCode]
        AND
         current_rows.[FiscalYear] = last_rows.[FiscalYear]
        AND
         current_rows.[AccountingDocument] = last_rows.[AccountingDocument]
        AND
         current_rows.[LedgerGLLineItem] = last_rows.[LedgerGLLineItem]
