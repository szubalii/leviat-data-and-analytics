CREATE VIEW [base_s4h_cax].[vw_C_BillingDocumentItemBasicDEX]
AS
with last_rows as (
    select max([TS_SEQUENCE_NUMBER]) as TS_SEQUENCE_NUMBER,
           max([t_extractionDtm])    as [t_extractionDtm],
           [MANDT],
           [BillingDocument],
           [BillingDocumentItem]
    from [base_s4h_cax].[C_BillingDocumentItemBasicDEX_delta]
    group by [MANDT], [BillingDocument], [BillingDocumentItem]
)
select current_rows.[MANDT]
     , current_rows.[ODQ_CHANGEMODE]
     , current_rows.[ODQ_ENTITYCNTR]
     , current_rows.[BillingDocument]
     , current_rows.[BillingDocumentItem]
     , current_rows.[SalesDocumentItemCategory]
     , current_rows.[SalesDocumentItemType]
     , current_rows.[ReturnItemProcessingType]
     , current_rows.[BillingDocumentType]
     , current_rows.[BillingDocumentCategory]
     , current_rows.[SDDocumentCategory]
     , current_rows.[CreationDate]
     , current_rows.[CreationTime]
     , current_rows.[LastChangeDate]
     , current_rows.[BillingDocumentDate]
     , current_rows.[BillingDocumentIsTemporary]
     , current_rows.[OrganizationDivision]
     , current_rows.[Division]
     , current_rows.[SalesOffice]
     , current_rows.[SalesOrganization]
     , current_rows.[DistributionChannel]
     , current_rows.[Material]
     , current_rows.[OriginallyRequestedMaterial]
     , current_rows.[InternationalArticleNumber]
     , current_rows.[PricingReferenceMaterial]
     , current_rows.[Batch]
     , current_rows.[MaterialGroup]
     , current_rows.[AdditionalMaterialGroup1]
     , current_rows.[AdditionalMaterialGroup2]
     , current_rows.[AdditionalMaterialGroup3]
     , current_rows.[AdditionalMaterialGroup4]
     , current_rows.[AdditionalMaterialGroup5]
     , current_rows.[MaterialCommissionGroup]
     , current_rows.[Plant]
     , current_rows.[StorageLocation]
     , current_rows.[BillingDocumentIsCancelled]
     , current_rows.[CancelledBillingDocument]
     , current_rows.[BillingDocumentItemText]
     , current_rows.[ServicesRenderedDate]
     , current_rows.[BillingQuantity]
     , current_rows.[BillingQuantityUnit]
     , current_rows.[BillingQuantityInBaseUnit]
     , current_rows.[BaseUnit]
     , current_rows.[MRPRequiredQuantityInBaseUnit]
     , current_rows.[BillingToBaseQuantityDnmntr]
     , current_rows.[BillingToBaseQuantityNmrtr]
     , current_rows.[ItemGrossWeight]
     , current_rows.[ItemNetWeight]
     , current_rows.[ItemWeightUnit]
     , current_rows.[ItemVolume]
     , current_rows.[ItemVolumeUnit]
     , current_rows.[BillToPartyCountry]
     , current_rows.[BillToPartyRegion]
     , current_rows.[BillingPlanRule]
     , current_rows.[BillingPlan]
     , current_rows.[BillingPlanItem]
     , current_rows.[CustomerPriceGroup]
     , current_rows.[PriceListType]
     , current_rows.[TaxDepartureCountry]
     , current_rows.[VATRegistration]
     , current_rows.[VATRegistrationCountry]
     , current_rows.[VATRegistrationOrigin]
     , current_rows.[CustomerTaxClassification1]
     , current_rows.[CustomerTaxClassification2]
     , current_rows.[CustomerTaxClassification3]
     , current_rows.[CustomerTaxClassification4]
     , current_rows.[CustomerTaxClassification5]
     , current_rows.[CustomerTaxClassification6]
     , current_rows.[CustomerTaxClassification7]
     , current_rows.[CustomerTaxClassification8]
     , current_rows.[CustomerTaxClassification9]
     , current_rows.[SDPricingProcedure]
     , current_rows.[NetAmount]
     , current_rows.[TransactionCurrency]
     , current_rows.[GrossAmount]
     , current_rows.[PricingDate]
     , current_rows.[PriceDetnExchangeRate]
     , current_rows.[PricingScaleQuantityInBaseUnit]
     , current_rows.[TaxAmount]
     , current_rows.[CostAmount]
     , current_rows.[Subtotal1Amount]
     , current_rows.[Subtotal2Amount]
     , current_rows.[Subtotal3Amount]
     , current_rows.[Subtotal4Amount]
     , current_rows.[Subtotal5Amount]
     , current_rows.[Subtotal6Amount]
     , current_rows.[StatisticalValueControl]
     , current_rows.[StatisticsExchangeRate]
     , current_rows.[StatisticsCurrency]
     , current_rows.[SalesOrganizationCurrency]
     , current_rows.[EligibleAmountForCashDiscount]
     , current_rows.[ContractAccount]
     , current_rows.[CustomerPaymentTerms]
     , current_rows.[PaymentMethod]
     , current_rows.[PaymentReference]
     , current_rows.[FixedValueDate]
     , current_rows.[AdditionalValueDays]
     , current_rows.[PayerParty]
     , current_rows.[CompanyCode]
     , current_rows.[FiscalYear]
     , current_rows.[FiscalPeriod]
     , current_rows.[CustomerAccountAssignmentGroup]
     , current_rows.[BusinessArea]
     , current_rows.[ProfitCenter]
     , current_rows.[OrderID]
     , current_rows.[ControllingArea]
     , current_rows.[ProfitabilitySegment]
     , current_rows.[CostCenter]
     , current_rows.[OriginSDDocument]
     , current_rows.[OriginSDDocumentItem]
     , current_rows.[PriceDetnExchangeRateDate]
     , current_rows.[ExchangeRateType]
     , current_rows.[FiscalYearVariant]
     , current_rows.[Currency]
     , current_rows.[AccountingExchangeRate]
     , current_rows.[AccountingExchangeRateIsSet]
     , current_rows.[ReferenceSDDocument]
     , current_rows.[ReferenceSDDocumentItem]
     , current_rows.[ReferenceSDDocumentCategory]
     , current_rows.[SalesDocument]
     , current_rows.[SalesDocumentItem]
     , current_rows.[SalesSDDocumentCategory]
     , current_rows.[HigherLevelItem]
     , current_rows.[BillingDocumentItemInPartSgmt]
     , current_rows.[SalesGroup]
     , current_rows.[AdditionalCustomerGroup1]
     , current_rows.[AdditionalCustomerGroup2]
     , current_rows.[AdditionalCustomerGroup3]
     , current_rows.[AdditionalCustomerGroup4]
     , current_rows.[AdditionalCustomerGroup5]
     , current_rows.[SDDocumentReason]
     , current_rows.[ItemIsRelevantForCredit]
     , current_rows.[CreditRelatedPrice]
     , current_rows.[SalesDistrict]
     , current_rows.[CustomerGroup]
     , current_rows.[SoldToParty]
     , current_rows.[Country]
     , current_rows.[ShipToParty]
     , current_rows.[BillToParty]
     , current_rows.[ShippingPoint]
     , current_rows.[IncotermsVersion]
     , current_rows.[IncotermsClassification]
     , current_rows.[IncotermsTransferLocation]
     , current_rows.[IncotermsLocation1]
     , current_rows.[IncotermsLocation2]
     , current_rows.[ShippingCondition]
     , current_rows.[t_applicationId]
     , current_rows.[t_jobId]
     , current_rows.[t_jobDtm]
     , current_rows.[t_jobBy]
     , current_rows.[t_extractionDtm]
     , current_rows.[t_filePath]
from last_rows
join [base_s4h_cax].[C_BillingDocumentItemBasicDEX_delta] current_rows on
        current_rows.[TS_SEQUENCE_NUMBER] = last_rows.[TS_SEQUENCE_NUMBER]
        and current_rows.[t_extractionDtm] = last_rows.[t_extractionDtm]
        and current_rows.[MANDT] = last_rows.[MANDT]
        and current_rows.[BillingDocument] = last_rows.[BillingDocument]
        and current_rows.[BillingDocumentItem] = last_rows.[BillingDocumentItem]
