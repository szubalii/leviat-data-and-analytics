jobs:
  # Start VM
- job: StartVM
  pool: server
  steps:
  
  - script: |
      echo system.pullRequest.targetBranch: $(system.pullRequest.targetBranch)
      echo user: $(user)
      echo dataFactoryName: $(dataFactoryName)
      echo sqlDatabaseName: $(sqlDatabaseName)
      echo synapseSqlPool: $(synapseSqlPool)
      echo storageAccountName: $(storageAccountName)
      echo xuPrefix: $(xuPrefix)
      echo branchName: $(branchName)
      echo destination: $(destination)
      echo Build.Reason: ${{ variables['Build.Reason'] }}
      echo Build.SourceBranchName: ${{ variables['Build.SourceBranchName'] }}
      echo VMName: ${{ variables['VMName'] }}
      echo VMResourceGroup: ${{ variables['VMResourceGroup'] }}
    displayName: Print Variables

  - task: InvokeRESTAPI@1
    inputs:
      connectionType: 'connectedServiceNameARM'
      azureServiceConnection: 'arm-pipeline'
      method: 'POST'
      urlSuffix: '/subscriptions/f199b488-7d9d-4992-aeda-c10a1e1c9b9e/resourceGroups/$(VMResourceGroup)/providers/Microsoft.Compute/virtualMachines/$(VMName)/start?api-version=2022-03-01'
      waitForCompletion: 'false'
    displayName: 'Start VM'