steps:
- task: CopyFiles@2
  inputs:
    SourceFolder: '$(Build.SourcesDirectory)/xu-config/extractions'
    Contents: '**\*'
    TargetFolder: '$(Build.ArtifactStagingDirectory)/extractions'

# Update the extraction names by renaming the folders to include the environment prefix
# - script: for /d %D in ("$(System.DefaultWorkingDirectory)\xu-config\extractions\*") do ren "%D" "$(environment)_%~nxD"
- task: PowerShell@2
  displayName: Add prefix to extractions
  inputs:
    targetType: 'inline'
    pwsh: true
    script: |
      Get-ChildItem -Path '$(Build.ArtifactStagingDirectory)/extractions' |
      Foreach-Object {Rename-Item -Path $_.FullName -NewName ("$(xuPrefix)_"+($_.Name))}

# Update the source and destinations in the extractions
- task: FileTransform@1
  displayName: 'File Transform: Destination and Source in Extractions'
  inputs:
    folderPath: '$(Build.ArtifactStagingDirectory)/extractions'
    fileType: json
    targetFiles: '**/general.json'

- task: PublishPipelineArtifact@1
  inputs:
    path: '$(Build.ArtifactStagingDirectory)'
    artifactName: 'XtractUniversal'
    artifactType: 'pipeline'