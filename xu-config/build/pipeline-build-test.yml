trigger: none # triggered by PR

variables:
- template: ../../build/variables-test.yml
- name: xuPrefix
  value: $(System.PullRequest.PullRequestId)
- name: storageAccountName
  value: stprdeuw001

jobs:
- job: BUILD
  pool:
    name: 'VM'
    demands:
    - node.js
    - VisualStudio
    - Agent.ComputerName -equals $(VMName)
  steps:
  - template: ./steps-build.yml
  - template: ./steps-artifact.yml
- job: DEPLOY
  dependsOn: BUILD
  pool:
    name: 'VM'
    demands:
    - node.js
    - VisualStudio
    - Agent.ComputerName -equals $(VMName)
  steps:
  - template: ./steps-deploy.yml
# - job: GET_CHANGED_EXTRACTIONS
#   pool:
#     vmImage: 'ubuntu-20.04'
#   steps:
#   - checkout: self
#     fetchDepth: 0 # disables shallow fetch and results in correct return of git diff-tree
  
#   # - bash: |
#   #     git diff --name-only $(System.PullRequest.SourceCommitId)^!
#   #     git diff --name-only $SYSTEM_PULLREQUEST_SOURCECOMMITID^!

#   #     $(git diff --name-only $(System.PullRequest.SourceCommitId)^!)
#   #     $(git diff --name-only $SYSTEM_PULLREQUEST_SOURCECOMMITID^!)

#   - pwsh: |
#       git diff --name-only 199bf9131748a7e07d4074baf8f7dd2daf94d963^!
#       git diff --name-only $(commitId)^!
# - job: TEST_XU_CONFIG
#   variables:
  
#   pool: 'VM'
#   demands:
#   - node.js
#   - VisualStudio
#   - Agent.ComputerName -equals $(VMName)
  
#   steps:
#   - script