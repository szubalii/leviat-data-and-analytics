steps:

  - task: AzurePowerShell@5
    displayName: 'Stop Triggers'
    inputs:
      azureSubscription: 'arm-pipeline'
      ScriptPath: '$(Build.Repository.LocalPath)\azure-data-factory\ArmTemplate\PrePostDeploymentScript.ps1'
      ScriptArguments: '-armTemplate "$(Build.Repository.LocalPath)\azure-data-factory\ArmTemplate\ARMTemplateForFactory.json" -ResourceGroupName $(resourceGroupName) -DataFactoryName $(dataFactoryName) -predeployment $true -deleteDeployment $false -ArmTemplateParameters "$(Build.Repository.LocalPath)\azure-data-factory\ArmTemplate\ARMTemplateParametersForFactory.json" -ExplicitStopTriggerList "tr_AutoPauseSynDW"'
      azurePowerShellVersion: LatestVersion
      pwsh: true

  - task: AzurePowerShell@5
    displayName: 'Azure PowerShell script: FilePath'
    inputs:
      azureSubscription: 'arm-pipeline'
      ScriptPath: '$(Build.Repository.LocalPath)\azure-data-factory\ArmTemplate\GlobalParametersUpdateScript.ps1'
      ScriptArguments: '-globalParametersFilePath $(Build.Repository.LocalPath)\azure-data-factory\GlobalParameters\dev_GlobalParameters.json -resourceGroupName $(resourceGroupName) -dataFactoryName $(dataFactoryName)'
      azurePowerShellVersion: LatestVersion
      pwsh: true
    
  - task: AzureResourceManagerTemplateDeployment@3
    displayName: 'ARM Template deployment: Resource Group scope'
    inputs:
      azureResourceManagerConnection: 'arm-pipeline'
      subscriptionId: 'f199b488-7d9d-4992-aeda-c10a1e1c9b9e'
      resourceGroupName: '$(resourceGroupName)'
      location: 'West Europe'
      csmFile: '$(Build.Repository.LocalPath)\azure-data-factory\ArmTemplate\ARMTemplateForFactory.json'
      csmParametersFile: '$(Build.Repository.LocalPath)\azure-data-factory\ArmTemplate\ARMTemplateParametersForFactory.json'
      overrideParameters: '-factoryName $(dataFactoryName) -tr_AutoPauseSynDW_properties_pl_SYNDW_pause_parameters_SynapseServerName $(workspaceName) -tr_AutoPauseSynDW_properties_pl_SYNDW_pause_parameters_SynapseDatabaseName $(synapseSqlPool)'
      # '-ls_ws_xxxx_sls_x_euw_001_ondemand__synapse_od_connectionString "Integrated Security=False;Encrypt=True;Connection Timeout=30;Data Source=$(workspaceName)-ondemand.sql.azuresynapse.net;Initial Catalog=synapse_od" -ls_ws_xxxx_sls_x_euw_001_ondemand__master_connectionString "Integrated Security=False;Encrypt=True;Connection Timeout=30;Data Source=$(workspaceName)-ondemand.sql.azuresynapse.net;Initial Catalog=master" -ls_ws_xxxx_sls_x_euw_001__syndw_xxxx_sls_x_euw_001_connectionString "Integrated Security=False;Encrypt=True;Connection Timeout=30;Data Source=$(workspaceName);Initial Catalog=$(synapseSqlPool)" -ls_sqlsrv_xxxx_sls_x_euw_001__sqldb_xxxx_sls_x_euw_001_connectionString "Integrated Security=False;Encrypt=True;Connection Timeout=30;Data Source=$(sqlServerName);Initial Catalog=$(sqlDatabaseName)" -ls_axbi_x_TimeXtender__master_connectionString "Integrated Security=False;Data Source=$(axbiServer);Initial Catalog=master;User ID=JustBI" -factoryName "$(dataFactoryName)" -ls_kv_xxxx_sls_x_euw_001_properties_typeProperties_baseUrl "https://$(keyVaultName).vault.azure.net/" -stxxxxslsxeuw001_properties_typeProperties_url "https://$(storageAccountName).dfs.core.windows.net/" -tr_AutoPauseSynDW_properties_pl_SYNDW_pause_parameters_SynapseServerName "$(workspaceName)" -tr_AutoPauseSynDW_properties_pl_SYNDW_pause_parameters_SynapseDatabaseName "$(synapseSqlPool)" -tr_AutoPauseSynDW_properties_pl_SYNDW_pause_parameters_ResourceGroupName "$(resourceGroupName)" -tr_OrchDB_Update_properties_typeProperties_scope "/subscriptions/f199b488-7d9d-4992-aeda-c10a1e1c9b9e/resourceGroups/$(resourceGroupName)/providers/Microsoft.Storage/storageAccounts/$(storageAccountName)" -ir-WEXLEVAPP001_properties_typeProperties_linkedInfo_resourceId "$(SHIRResourceId)" -ls_c4c_my354744_properties_typeProperties_url "$(sapC4Curl)"'
  
  - task: AzurePowerShell@5
    displayName: 'Start Triggers'
    inputs:
      azureSubscription: 'arm-pipeline'
      ScriptPath: '$(Build.Repository.LocalPath)\azure-data-factory\ArmTemplate\PrePostDeploymentScript.ps1'
      ScriptArguments: '-armTemplate "$(Build.Repository.LocalPath)\azure-data-factory\ArmTemplate\ARMTemplateForFactory.json" -ResourceGroupName $(resourceGroupName) -DataFactoryName $(dataFactoryName) -predeployment $false -deleteDeployment $true'
      azurePowerShellVersion: LatestVersion
      pwsh: true